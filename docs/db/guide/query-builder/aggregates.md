# Агрегации

В Evas-Db доступны методы для сборки популярных функций агрегации из баз данных. Их можно применять как ко всей выборке, так и к подмножествам сгруппированным с помощью groupBy.

## count
Добавляет агрегат количества значений в столбце/столбцах.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->count('id');
$builder->count('id', 'published', 'sandbox');
```

## getCount
Добавляет агрегат количества значений в столбце/столбцах **с отправкой запроса**.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->getCount('id');
$builder->getCount('id', 'published', 'sandbox');
```


## sum
Добавляет агрегат суммы значений в столбце/столбцах.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->sum('orders_num');
$builder->sum('orders_num', 'reviews_num');
```

## getSum
Добавляет агрегат суммы значений в столбце/столбцах **с отправкой запроса**.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->getSum('orders_num');
$builder->getSum('orders_num', 'reviews_num');
```


## min
Добавляет агрегат минимального значения в столбце/столбцах.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->min('views_num');
$builder->min('views_num', 'orders_num');
```

## getMin
Добавляет агрегат минимального значения в столбце/столбцах **с отправкой запроса**.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->getMin('views_num');
$builder->getMin('views_num', 'orders_num');
```


## max
Добавляет агрегат максимального значения в столбце/столбцах.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->max('views_num');
$builder->max('views_num', 'orders_num', 'reviews_num');
```

## getMax
Добавляет агрегат максимального значения в столбце/столбцах **с отправкой запроса**.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->getMax('views_num');
$builder->getMax('views_num', 'orders_num', 'reviews_num');
```


## avg
Добавляет агрегат среднего значения в столбце/столбцах.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->avg('views_num');
$builder->avg('views_num', 'orders_num', 'reviews_num');
```

## getAvg
Добавляет агрегат среднего значения в столбце/столбцах **с отправкой запроса**.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *...string* | столбец/столбцы |
```PHP
$builder->getAvg('views_num');
$builder->getAvg('views_num', 'orders_num', 'reviews_num');
```



## aggregates

Добавляет агрегаты в запрос.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *array* | агрегаты |

```PHP
$builder->aggregates([
    'min' => 'price', 
    'max' => 'rating', 
    'avg' => ['price', 'rating']
]);
```

## getAggregates

Добавляет агрегаты в запрос **с отправкой запроса**.
| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *array* | агрегаты |

```PHP
$builder->getAggregates([
    'min' => 'price', 
    'max' => 'rating', 
    'avg' => ['price', 'rating']
]);
```


## agregate
Добавляет агрегат в запрос.
| Аргумент | Тип | Описание | По умолчанию |
|----------|-----|----------|--------------|
| 1 | *string* | функция агрегаты (COUNT,SUM,MIN,MAX,AVG) |
| 2 | *array* | столбцы агрегаты | ['\*'] |

```PHP
$builder->aggregate('avg', ['price', 'rating']); // среднее значение стоимости и рейтинга
$builder->aggregate('avg'); // среднее значение всех столбцов
```

## getAgregate
Добавляет агрегат в запрос **с отправкой запроса**.
| Аргумент | Тип | Описание | По умолчанию |
|----------|-----|----------|--------------|
| 1 | *string* | функция агрегаты (COUNT,SUM,MIN,MAX,AVG) |
| 2 | *array* | столбцы агрегаты | ['\*'] |

```PHP
$builder->getAgregate('avg', ['price', 'rating']); // среднее значение стоимости и рейтинга
$builder->getAgregate('avg'); // среднее значение всех столбцов
```
