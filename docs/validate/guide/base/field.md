# Валидатор поля

Класс `Evas\Validate\Field` позволяет создавать валидаторы поля.

## Конфигурация

### Конструктор

| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *array\|null* | параметры валидатора поля |

Сигнатура:
```php
public function __construct(array $props = null);
```

Пример:

```php
// создаем и настраиваем валидатор поля
new Field([
    'label' => 'Email',
    'min' => 8,
    'max' => 60,
    'pattern' => '/^.{2,}@.{2,}\..{2,}$/',
]);
```

### Свойства

| Имя | Тип | Описание | По умолчанию |
|-----|-----|----------|--------------|
| $name | *string* | имя поля |
| $label | *string* | псевдоним поля |
| $valueBefore | *mixed* | пришедшее в поле значение до валидации |
| $value | *mixed* | значение поля после валидации |
| $default | *mixed* | значение по умолчанию в сулчае отсутствия значения |
| $type | *string* | тип поля | 'string' |
| $checkType | *bool* | проверять ли тип значения | false |
| $required | *bool* | обязательность | true |
| $trim | *bool* | делать ли очистку пробельных символов по краям строки | true |
| $min | *int* | минимальная длина строки или значение диапазона для чисел |
| $pattern | *string* | регулярное выражение |
| $matches | *array* | совпадения по регулярке |
| $options | *array* | опции поля |
| $same | *string* | поле с совпадающим значением |
| $sameLabel | *string* | псевдоним совпадающего поля |
| $error | *string* | сообщение ошибки |
| $undefinedType | *string* | тип поля для которого отсутствует функция проверки типа |
| $prepareValueCb | *callable* | колбэк для подготовки значения к валидации |

### Свойства сообщений ошибок

| Имя | Тип | Описание |
|-----|-----|----------|
| $requiredError | *string* | шаблон ошибки отсутствия значения, если поле обязательно |
| $undefinedTypeError | *string* | шаблон ошибки отсутствия функции проверки типа |
| $typeError | *string* | шаблон ошибки неправильного типа значения |
| $lengthError | *string* | шаблон ошибки длины текстового поля |
| $minLengthError | *string* | шаблон ошибки длины, если есть только мин. длина |
| $maxLengthError | *string* | шаблон ошибки длины, если есть только макс. длина |
| $rangeError | *string* | шаблон ошибки непопадания в диапазон значений |
| $minRangeError | *string* | шаблон ошибки диапазона, если есть только мин. |
| $maxRangeError | *string* | шаблон ошибки диапазона, если есть только макс. |
| $patternError | *string* | шаблон ошибки регулярки |
| $optionsSettingError | *string* | шаблон ошибки указания опций поля |
| $optionsError | *string* | шаблон ошибки несовпадения с опциями поля |
| $sameError | *string* | шаблон ошибки несовпадения значений в совпадающих полях |


## Валидация

### isValid

Проверяет значение на полную валидность полю

| Аргумент | Тип | Описание | По умолчанию |
|----------|-----|----------|--------------|
| 1 | *mixed* | значение |
| 2 | *bool* | пришло ли поле | true |

```php
$field->isValid(2);
```

### throwIfNotValid

Проверяет значение на валидность полю с выбросом исключения `Evas\Validate\ValidateException` в случае ошибки.


| Аргумент | Тип | Описание | По умолчанию |
|----------|-----|----------|--------------|
| 1 | *mixed* | значение |
| 2 | *bool* | пришло ли поле | true |

```php
$field->throwIfNotValid('test');
```


## Частичная валидация

### checkType
Проверяет тип значения

| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *mixed\|null* | значение для проверки |

```php
$field->checkType('значение для проверки');
```

### checkLength
Проверяет длину строки или диапазон значения

| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *mixed\|null* | значение для проверки |

```php
$field->checkLength('значение для проверки');
```

### checkPattern
Валидация с помощью регулярных выражений

| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *mixed\|null* | значение для проверки |

```php
$field->checkPattern('значение для проверки');
```

### checkOptions
Проверяет на соответствие опциям

| Аргумент | Тип | Описание |
|----------|-----|----------|
| 1 | *mixed\|null* | значение для проверки |

```php
$field->checkOptions('значение для проверки');
```


## Получение ошибок валидации
В случае ошибки валидации, текст ошибки будет записан в переменную `$error`

```php
$field = new Field(['min' => 3, 'max' => 10]);
if (!$field->isValid('Hi')) {
    // выведет текст ошибки длины
    // в данном случае: 'error.validate.field.length.min'
    die($field->error);
}
```

Текст ошибки поддерживает шаблонизацию, вы можете изменить шаблоны ошибок, подробнее об этом в разделе [Кастомизация ошибок](/guide/extra/custom-errors.html)

## Получение отвалидированного значения

В случае успеха валидации, отвалидированное значение будет доступно в переменной `$value`

```php
$field = new Field(['min' => 3, 'max' => 10]);
if (!$field->isValid('John')) {
    die($field->error);
}
echo 'Hi there! I\'m ' . $field->value; // выводим отвалидированное значение
```

## Хуки

### afterValidate
Срабатывает после валидации поля

```php
protected function afterValidate()
{
    $this->value = json_decode($this->value, true);
}
```


## Наследование

Вы можете создать свой класс валидатора набора полей отнаследовавшись от `Evas\Validate\Field`.

Примеры можно посмотреть в [готовых валидаторах полей](/guide/base/prepared-fields.html).

### prepareValue
Задаёт подготовку значения к валидации.

Исользуется в кастомных валидаторах полей.

```PHP
/**
 * Подготовка значения к валидации для кастомных классов валидаторов полей.
 * @param mixed значение
 * @return mixed подготовленное значение
 */
public function prepareValue($value)
{
    return $value;
}
```
